#!groovy

properties([disableConcurrentBuilds()])

pipeline{
	agent {
		label 'master'
	}
	triggers {pollSCM('* * * * *')}
	options {
		buildDiscarder(logRotator(numToKeepStr:'10',artifactNumToKeepStr:'10'))
		timestamps()
	}
	stages {
		stage('build'){
			steps {
				script{
					sh('git clone git@github.com:MrJekso/LyskovoChat.git')
					sh("docker build LyskovoChat/backend/friends -t sonicsmall/friend:${BUILD_ID}.${BUILD_ID}.${BUILD_ID}")
					sh('docker image rm  $(docker images sonicsmall/friend -q)')
					echo "NUMBER BUILD:::: ${env.BUILD_ID}"
				}
			}
		}
	}
	post{
		always {
			cleanWs ()
		}
	}
	
}
